<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cable Railing Configuration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h3 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #0078D7;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      color: #555;
      font-weight: bold;
      font-size: 13px;
      margin-bottom: 8px;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 14px;
    }
    select:focus, input[type="number"]:focus {
      outline: none;
      border-color: #0078D7;
      box-shadow: 0 0 5px rgba(0, 120, 215, 0.3);
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      height: auto;
    }
    .button-container {
      margin-top: 30px;
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid #ddd;
    }
    button {
      padding: 10px 25px;
      margin: 0 10px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .btn-primary {
      background-color: #0078D7;
      color: white;
    }
    .btn-primary:hover {
      background-color: #005ca0;
    }
    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }
    .btn-secondary:hover {
      background-color: #545b62;
    }
    .info {
      background-color: #e3f2fd;
      border-left: 4px solid #0078D7;
      padding: 10px;
      margin-top: 20px;
      font-size: 12px;
      color: #555;
    }
    .error {
      color: red;
      font-size: 12px;
      margin-top: 5px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h3>Cable Railing Configuration</h3>

    <div class="form-group">
      <label for="railing_height">Railing Height (inches):</label>
      <input type="number" id="railing_height" value="42" min="36" max="54" step="0.25">
      <div class="error" id="height-error"></div>
    </div>

    <div class="form-group">
      <label for="caprail_material">Caprail Material:</label>
      <select id="caprail_material">
        <option value="Aluminum" selected>Aluminum</option>
        <option value="Wood">Wood</option>
      </select>
    </div>

    <div class="info">
      <strong>Cable Railing Specifications:</strong><br>
      • Cable diameter: 1/4"<br>
      • Cable spacing: 3" on center<br>
      • First cable: 3" above floor<br>
      • Post spacing: Maximum 48"<br>
      • Post size: 2" x 2"<br>
      • Post base: 3.5" x 3.5" x 1"<br>
      • Posts are 2" shorter than total height<br>
      • Caprail is always included
    </div>

    <div class="button-container">
      <button class="btn-primary" id="createButton" onclick="createCableRailing()">Create Railing</button>
      <button class="btn-secondary" onclick="cancel()">Cancel</button>
    </div>
  </div>

  <script>
    const heightInput = document.getElementById('railing_height');
    const caprailMaterialSelect = document.getElementById('caprail_material');
    const heightError = document.getElementById('height-error');
    const createButton = document.getElementById('createButton');

    let toolActive = false;

    function validateHeight() {
      const height = parseFloat(heightInput.value);
      heightError.style.display = 'none';

      if (isNaN(height) || height < 36 || height > 54) {
        heightError.textContent = 'Height must be between 36" and 54"';
        heightError.style.display = 'block';
        return false;
      }

      return true;
    }

    heightInput.addEventListener('input', validateHeight);

    function resetButton() {
      toolActive = false;
      createButton.textContent = 'Create Railing';
      createButton.style.backgroundColor = '#0078D7';
    }

    function createCableRailing() {
      if (!toolActive) {
        if (!validateHeight()) {
          return;
        }

        const values = {
          railing_height: parseFloat(heightInput.value),
          caprail_material: caprailMaterialSelect.value
        };

        window.location = 'skp:create_cable_railing@' + JSON.stringify(values);

        toolActive = true;
        createButton.textContent = 'Finish Railing';
        createButton.style.backgroundColor = '#28a745';
      } else {
        window.location = 'skp:finish_selection';
        toolActive = false;
        createButton.textContent = 'Create Railing';
        createButton.style.backgroundColor = '#0078D7';
      }
    }

    function cancel() {
      window.location = 'skp:cancel';
    }

    window.addEventListener('load', function() {
      setTimeout(function() {
        const bodyHeight = document.body.scrollHeight;
        const bodyWidth = document.body.scrollWidth;

        window.location = 'skp:resize_dialog@' + JSON.stringify({
          width: Math.max(450, bodyWidth + 50),
          height: Math.max(450, bodyHeight + 50)
        });
      }, 100);
    });
  </script>
</body>
</html>
